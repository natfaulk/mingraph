var Mindrawingjs=require("mindrawingjs");Mingraphing=function(t,s){for(var i in this._options={chartWidth:800,chartHeight:600,chartMargin:10,numberOfCharts:1,drawMargins:!0,type:"line",bipolar:!1,tooltip:!0,xMax:-1},s)this._options[i]=s[i];this.graphs={dataset:[],colors:[],keys:[],labels:[],chartNumbers:[],maxVals:[]},this.lastMouse={x:-1,y:-1},this.d=new Mindrawingjs;var h=this._options.numberOfCharts*(this._options.chartHeight+this._options.chartMargin)+this._options.chartMargin;if(this.d.setup(t,this._options.chartWidth,h),this.d.background("#000"),this._options.drawMargins&&this._drawMargins(),this._options.tooltip){var a=this;document.onmousemove=function(t){0<a.graphs.dataset.length&&(a.draw(),a.drawTooltip(t.pageX,t.pageY),a.lastMouse.x=t.pageX,a.lastMouse.y=t.pageY)}}},Mingraphing.prototype._drawMargins=function(){this.d.stroke("#FFFFFF");for(var t=0,s=0;s<this._options.numberOfCharts;s++)t+=this._options.chartMargin,this.d.line(0,t,this.d.width,t),t+=this._options.chartHeight,this.d.line(0,t,this.d.width,t)},Mingraphing.prototype.addData=function(t,s,i,h,a,r){this.graphs.colors.push(i),this.graphs.keys.push(s),this.graphs.labels.push(r),this.graphs.chartNumbers.push(h),this.graphs.maxVals.push(a);for(var o=0;o<t.length;o++)o>=this.graphs.dataset.length&&this.graphs.dataset.push({}),this.graphs.dataset[o][s]=t[o][s];this.draw()},Mingraphing.prototype.updateData=function(t,s){for(var i=0;i<t.length;i++)i>=this.graphs.dataset.length&&this.graphs.dataset.push({}),this.graphs.dataset[i][s]=t[i][s];this.draw(),0<=this.lastMouse.x&&0<=this.lastMouse.y&&this.drawTooltip(this.lastMouse.x,this.lastMouse.y)},Mingraphing.prototype.draw=function(){this.clear();for(var t=0;t<this.graphs.keys.length;t++)"line"==this._options.type?this._drawLine(this.graphs.dataset,this.graphs.keys[t],this.graphs.colors[t],this.graphs.chartNumbers[t],this.graphs.maxVals[t]):"bar"==this._options.type&&this._drawBar(this.graphs.dataset,this.graphs.keys[t],this.graphs.colors[t],this.graphs.chartNumbers[t],this.graphs.maxVals[t])},Mingraphing.prototype.drawTooltip=function(t,s){var i=this.d.c.getBoundingClientRect(),h=t-i.left;1e3<h&&(h-=150);var a=Math.round(this.graphs.dataset.length/this._options.chartWidth*(t-i.left));a>=this.graphs.dataset.length&&(a=this.graphs.dataset.length-1),a<0&&(a=0),this.d.stroke("#FFFFFF"),this.d.line(t-i.left,0,t-i.left,this._options.numberOfCharts*(this._options.chartHeight+this._options.chartMargin)+this._options.chartMargin),this.d.textSize(20),this.d.fill("#FFFFFF");var r=a;0<this._options.xMax&&(r=a/this.graphs.dataset.length*this._options.xMax),this.d.text("X: "+r,h+5,s+25-i.top);for(var o=0;o<this.graphs.keys.length;o++)this.d.fill(this.graphs.colors[o]),this.d.text(this.graphs.labels[o]+": "+this.graphs.dataset[a][this.graphs.keys[o]],h+5,s+55+30*o-i.top)},Mingraphing.prototype._drawLine=function(t,s,i,h,a){var r=0,o=0,n=0,e=0,p=this._options;this.d.stroke(i);for(var g=1;g<t.length;g++)t_ycom=h*(p.chartHeight+p.chartMargin)+p.chartMargin+p.chartHeight/2,p.bipolar||(t_ycom+=p.chartHeight/2),r=p.chartWidth*(g-1)/t.length,o=p.chartWidth*g/t.length,n=t_ycom-t[g-1][s]/a*p.chartHeight,e=t_ycom-t[g][s]/a*p.chartHeight,this.d.line(r,n,o,e)},Mingraphing.prototype._drawBar=function(t,s,i,h,a){var r=0,o=0,n=0,e=this._options;this.d.stroke(i);for(var p=0;p<t.length;p++)t_ycom=h*(e.chartHeight+e.chartMargin)+e.chartMargin+e.chartHeight/2,e.bipolar||(t_ycom+=e.chartHeight/2),r=e.chartWidth*p/t.length,o=t_ycom-t[p][s]/a*e.chartHeight,n=t_ycom,this.d.line(r,o,r,n)},Mingraphing.prototype.clear=function(){this.d.background("#000"),this._options.drawMargins&&this._drawMargins()},Mingraphing.prototype.tooltipEnabled=function(t){this._options.tooltip=t},"undefined"!=typeof module&&module.exports&&(module.exports=Mingraphing);